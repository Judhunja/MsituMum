<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Impact Predictions - MsituMum</title>
<script type="module" src="/main.js"></script>
</head>
<body class="font-display bg-gray-50">
<div class="flex h-screen">
<!-- Sidebar -->
<aside class="w-80 bg-white border-r border-gray-200 p-6 overflow-y-auto">
<div class="mb-8">
<h1 class="text-xl font-bold text-gray-900">Simulation Controls</h1>
<p class="text-sm text-gray-500">Adjust policy variables</p>
</div>

<div class="space-y-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Geographic Scope</label>
<select class="w-full rounded-md border-gray-300 shadow-sm" id="region-select">
<option>All Regions</option>
<option>North Region</option>
<option>South Region</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-green-800 mb-2">Time Horizon</label>
<select class="w-full rounded-md border-green-300 shadow-sm focus:border-green-500 focus:ring-green-500" id="timeline-select">
<option>1 Year</option>
<option>3 Years</option>
<option selected>5 Years</option>
<option>10 Years</option>
</select>
</div>

<div class="space-y-4">
<h3 class="font-semibold text-green-900">Policy Levers</h3>
<div>
<label class="block text-sm font-medium text-green-800">Subsidy Level (%)</label>
<input type="range" min="0" max="100" value="40" class="w-full accent-green-600" id="subsidy-slider">
<p class="text-sm text-green-700 font-medium mt-1" id="subsidy-value">40%</p>
</div>

<div>
<label class="block text-sm font-medium text-green-800">Technical Support (Hours)</label>
<input type="range" min="0" max="1000" value="250" class="w-full accent-green-600" id="support-slider">
<p class="text-sm text-green-700 font-medium mt-1" id="support-value">250 hours</p>
</div>

<div>
<label class="block text-sm font-medium text-green-800">Community Engagement ($)</label>
<input type="range" min="0" max="1000000" value="300000" step="10000" class="w-full accent-green-600" id="engagement-slider">
<p class="text-sm text-green-700 font-medium mt-1" id="engagement-value">$300,000</p>
</div>
</div>

<div class="space-y-3">
<label class="flex items-center justify-between">
<span class="text-sm font-medium text-gray-700">Enable Carbon Credit Program</span>
<input type="checkbox" checked class="rounded text-primary">
</label>
<label class="flex items-center justify-between">
<span class="text-sm font-medium text-gray-700">Mandate Native Species</span>
<input type="checkbox" class="rounded text-primary">
</label>
</div>
</div>

<button class="w-full mt-8 bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg font-bold shadow-lg transition-colors" onclick="runSimulation()">
Run Simulation
</button>
</aside>

<!-- Main Content -->
<main class="flex-1 overflow-y-auto p-8">
<div class="max-w-7xl mx-auto space-y-8">
<div class="flex items-center justify-between">
<div>
<h1 class="text-3xl font-black text-gray-900">Policy Impact Simulation</h1>
<p class="text-gray-600">Visualize the simulated impact of various policy measures on forest restoration.</p>
</div>
<a href="/dashboard.html" class="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors">
<span class="material-symbols-outlined">arrow_back</span>
Back to Dashboard
</a>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
<div class="bg-white p-6 rounded-xl border border-gray-200">
<p class="text-gray-600 text-sm font-medium">Projected Survival Rate</p>
<p class="text-3xl font-bold text-gray-900 my-2" id="pred-survival">82.5%</p>
<p class="text-green-600 text-sm font-medium">+5.2%</p>
</div>
<div class="bg-white p-6 rounded-xl border border-gray-200">
<p class="text-gray-600 text-sm font-medium">Biodiversity Index</p>
<p class="text-3xl font-bold text-gray-900 my-2" id="pred-biodiversity">0.78</p>
<p class="text-green-600 text-sm font-medium">+0.05</p>
</div>
<div class="bg-white p-6 rounded-xl border border-gray-200">
<p class="text-gray-600 text-sm font-medium">Total Carbon Sequestered</p>
<p class="text-3xl font-bold text-gray-900 my-2" id="pred-carbon">1.2M tCO₂e</p>
<p class="text-green-600 text-sm font-medium">+150k</p>
</div>
<div class="bg-white p-6 rounded-xl border border-gray-200">
<p class="text-gray-600 text-sm font-medium">Community Impact</p>
<p class="text-3xl font-bold text-gray-900 my-2">High</p>
<p class="text-green-600 text-sm font-medium">+12%</p>
</div>
</div>

<div class="bg-white p-6 rounded-xl border border-gray-200">
<h3 class="font-bold text-lg mb-4">Projected Survival Rate Over Time</h3>
<div style="height: 300px; position: relative;">
<canvas id="predictionChart"></canvas>
</div>
</div>

<div class="bg-white p-6 rounded-xl border border-gray-200">
<h3 class="font-bold text-lg mb-4">AI Recommendations</h3>
<div id="recommendations" class="space-y-3">
<div class="flex items-start gap-3 p-3 bg-blue-50 rounded-lg">
<span class="material-symbols-outlined text-blue-600">tips_and_updates</span>
<p class="text-sm text-gray-800">Increase watering frequency during dry season to improve survival rates</p>
</div>
<div class="flex items-start gap-3 p-3 bg-green-50 rounded-lg">
<span class="material-symbols-outlined text-green-600">tips_and_updates</span>
<p class="text-sm text-gray-800">Implement mulching to retain soil moisture and reduce mortality</p>
</div>
<div class="flex items-start gap-3 p-3 bg-yellow-50 rounded-lg">
<span class="material-symbols-outlined text-yellow-600">warning</span>
<p class="text-sm text-gray-800">High drought risk detected. Consider drought-resistant species</p>
</div>
</div>
</div>
</div>
</main>
</div>

<script type="module" src="/js/auth.js"></script>
<script>
let predChart = null;
let simulationRun = false;

// Update slider values
document.getElementById('subsidy-slider').addEventListener('input', (e) => {
  document.getElementById('subsidy-value').textContent = e.target.value + '%';
});
document.getElementById('support-slider').addEventListener('input', (e) => {
  document.getElementById('support-value').textContent = e.target.value + ' hours';
});
document.getElementById('engagement-slider').addEventListener('input', (e) => {
  document.getElementById('engagement-value').textContent = '$' + parseInt(e.target.value).toLocaleString();
});

// Initialize chart with empty state
function initializeChart() {
  const ctx = document.getElementById('predictionChart').getContext('2d');
  predChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Current', '1 Year', '3 Years', '5 Years'],
      datasets: [{
        label: 'Survival Rate',
        data: [],
        borderColor: '#166534',
        backgroundColor: 'rgba(22, 101, 52, 0.1)',
        tension: 0.4,
        fill: true,
        borderWidth: 3,
        pointRadius: 5,
        pointHoverRadius: 7
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          labels: {
            font: { size: 14, weight: 'bold' },
            color: '#166534'
          }
        },
        tooltip: {
          backgroundColor: 'rgba(22, 101, 52, 0.9)',
          titleFont: { size: 14, weight: 'bold' },
          bodyFont: { size: 13 },
          padding: 12,
          cornerRadius: 8
        }
      },
      scales: {
        y: { 
          beginAtZero: false, 
          min: 0, 
          max: 100,
          ticks: {
            callback: function(value) {
              return value + '%';
            },
            font: { size: 12 },
            color: '#4B5563',
            stepSize: 10
          },
          grid: {
            color: 'rgba(22, 101, 52, 0.1)'
          }
        },
        x: {
          ticks: {
            font: { size: 12 },
            color: '#4B5563'
          },
          grid: {
            display: false
          }
        }
      }
    }
  });
}

async function runSimulation() {
  const button = event?.target || document.querySelector('button[onclick="runSimulation()"]');
  if (button) {
    button.disabled = true;
    button.textContent = 'Running Simulation...';
  }

  try {
    // Get slider values
    const subsidyLevel = document.getElementById('subsidy-slider').value;
    const supportHours = document.getElementById('support-slider').value;
    const engagement = document.getElementById('engagement-slider').value;
    const timeline = document.getElementById('timeline-select').value;

    // Simulate calculation based on inputs (replace with actual API call if available)
    const baseRate = 75;
    const subsidyBonus = subsidyLevel * 0.15;
    const supportBonus = (supportHours / 1000) * 8;
    const engagementBonus = (engagement / 1000000) * 5;
    
    const year1 = Math.min(98, baseRate + subsidyBonus + supportBonus + engagementBonus + (Math.random() * 3));
    const year3 = Math.min(100, year1 + 1 + (Math.random() * 2)); // Growth with improved practices
    const year5 = Math.min(100, year3 + 0.5 + (Math.random() * 1.5)); // Sustained growth
    
    // Update display values
    document.getElementById('pred-survival').textContent = year1.toFixed(1) + '%';
    document.getElementById('pred-biodiversity').textContent = (0.65 + (subsidyLevel / 200)).toFixed(2);
    document.getElementById('pred-carbon').textContent = ((year1 / 100) * 1.5).toFixed(1) + 'M tCO₂e';
    
    // Update chart
    if (predChart) {
      predChart.data.datasets[0].data = [100, year1, year3, year5];
      predChart.update();
    }
    
    simulationRun = true;
    
    if (button) {
      button.disabled = false;
      button.textContent = 'Run Simulation';
      button.classList.add('animate-pulse');
      setTimeout(() => button.classList.remove('animate-pulse'), 1000);
    }
    
  } catch (error) {
    console.error('Simulation error:', error);
    if (button) {
      button.disabled = false;
      button.textContent = 'Run Simulation';
    }
  }
}

// Initialize chart on page load but don't run simulation
document.addEventListener('DOMContentLoaded', () => {
  initializeChart();
  // Show placeholder message
  document.getElementById('pred-survival').textContent = '--';
  document.getElementById('pred-biodiversity').textContent = '--';
  document.getElementById('pred-carbon').textContent = '--';
});
</script>
<script type="module" src="/js/check-auth.js"></script>
</body></html>
