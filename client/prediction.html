<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Impact Predictions - MsituMum</title>
<script src="https://cdn.tailwindcss.com?plugins=forms"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        "primary": "#2a5a49",
        "accent": "#4a90e2",
      },
      fontFamily: {
        "display": ["Inter", "sans-serif"]
      }
    }
  }
}
</script>
</head>
<body class="font-display bg-gray-50">
<div class="flex h-screen">
<!-- Sidebar -->
<aside class="w-80 bg-white border-r border-gray-200 p-6 overflow-y-auto">
<div class="mb-8">
<h1 class="text-xl font-bold text-gray-900">Simulation Controls</h1>
<p class="text-sm text-gray-500">Adjust policy variables</p>
</div>

<div class="space-y-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Geographic Scope</label>
<select class="w-full rounded-md border-gray-300 shadow-sm" id="region-select">
<option>All Regions</option>
<option>North Region</option>
<option>South Region</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Time Horizon</label>
<select class="w-full rounded-md border-gray-300 shadow-sm" id="timeline-select">
<option>1 Year</option>
<option>3 Years</option>
<option selected>5 Years</option>
<option>10 Years</option>
</select>
</div>

<div class="space-y-4">
<h3 class="font-semibold text-gray-900">Policy Levers</h3>
<div>
<label class="block text-sm font-medium text-gray-700">Subsidy Level (%)</label>
<input type="range" min="0" max="100" value="40" class="w-full accent-primary" id="subsidy-slider">
<p class="text-sm text-gray-600 mt-1" id="subsidy-value">40%</p>
</div>

<div>
<label class="block text-sm font-medium text-gray-700">Technical Support (Hours)</label>
<input type="range" min="0" max="1000" value="250" class="w-full accent-primary" id="support-slider">
<p class="text-sm text-gray-600 mt-1" id="support-value">250 hours</p>
</div>

<div>
<label class="block text-sm font-medium text-gray-700">Community Engagement ($)</label>
<input type="range" min="0" max="1000000" value="300000" step="10000" class="w-full accent-primary" id="engagement-slider">
<p class="text-sm text-gray-600 mt-1" id="engagement-value">$300,000</p>
</div>
</div>

<div class="space-y-3">
<label class="flex items-center justify-between">
<span class="text-sm font-medium text-gray-700">Enable Carbon Credit Program</span>
<input type="checkbox" checked class="rounded text-primary">
</label>
<label class="flex items-center justify-between">
<span class="text-sm font-medium text-gray-700">Mandate Native Species</span>
<input type="checkbox" class="rounded text-primary">
</label>
</div>
</div>

<button class="w-full mt-8 bg-primary text-white py-3 px-4 rounded-lg font-bold hover:opacity-90" onclick="runSimulation()">
Run Simulation
</button>
</aside>

<!-- Main Content -->
<main class="flex-1 overflow-y-auto p-8">
<div class="max-w-7xl mx-auto space-y-8">
<div>
<h1 class="text-3xl font-black text-gray-900">Policy Impact Simulation</h1>
<p class="text-gray-600">Visualize the simulated impact of various policy measures on forest restoration.</p>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
<div class="bg-white p-6 rounded-xl border border-gray-200">
<p class="text-gray-600 text-sm font-medium">Projected Survival Rate</p>
<p class="text-3xl font-bold text-gray-900 my-2" id="pred-survival">82.5%</p>
<p class="text-green-600 text-sm font-medium">+5.2%</p>
</div>
<div class="bg-white p-6 rounded-xl border border-gray-200">
<p class="text-gray-600 text-sm font-medium">Biodiversity Index</p>
<p class="text-3xl font-bold text-gray-900 my-2" id="pred-biodiversity">0.78</p>
<p class="text-green-600 text-sm font-medium">+0.05</p>
</div>
<div class="bg-white p-6 rounded-xl border border-gray-200">
<p class="text-gray-600 text-sm font-medium">Total Carbon Sequestered</p>
<p class="text-3xl font-bold text-gray-900 my-2" id="pred-carbon">1.2M tCOâ‚‚e</p>
<p class="text-green-600 text-sm font-medium">+150k</p>
</div>
<div class="bg-white p-6 rounded-xl border border-gray-200">
<p class="text-gray-600 text-sm font-medium">Community Impact</p>
<p class="text-3xl font-bold text-gray-900 my-2">High</p>
<p class="text-green-600 text-sm font-medium">+12%</p>
</div>
</div>

<div class="bg-white p-6 rounded-xl border border-gray-200">
<h3 class="font-bold text-lg mb-4">Projected Survival Rate Over Time</h3>
<canvas id="predictionChart" class="w-full" style="height: 300px;"></canvas>
</div>

<div class="bg-white p-6 rounded-xl border border-gray-200">
<h3 class="font-bold text-lg mb-4">AI Recommendations</h3>
<div id="recommendations" class="space-y-3">
<div class="flex items-start gap-3 p-3 bg-blue-50 rounded-lg">
<span class="material-symbols-outlined text-blue-600">tips_and_updates</span>
<p class="text-sm text-gray-800">Increase watering frequency during dry season to improve survival rates</p>
</div>
<div class="flex items-start gap-3 p-3 bg-green-50 rounded-lg">
<span class="material-symbols-outlined text-green-600">tips_and_updates</span>
<p class="text-sm text-gray-800">Implement mulching to retain soil moisture and reduce mortality</p>
</div>
<div class="flex items-start gap-3 p-3 bg-yellow-50 rounded-lg">
<span class="material-symbols-outlined text-yellow-600">warning</span>
<p class="text-sm text-gray-800">High drought risk detected. Consider drought-resistant species</p>
</div>
</div>
</div>
</div>
</main>
</div>

<script src="/js/auth.js"></script>
<script>
let predChart = null;

// Update slider values
document.getElementById('subsidy-slider').addEventListener('input', (e) => {
  document.getElementById('subsidy-value').textContent = e.target.value + '%';
});
document.getElementById('support-slider').addEventListener('input', (e) => {
  document.getElementById('support-value').textContent = e.target.value + ' hours';
});
document.getElementById('engagement-slider').addEventListener('input', (e) => {
  document.getElementById('engagement-value').textContent = '$' + parseInt(e.target.value).toLocaleString();
});

async function runSimulation() {
  try {
    const summary = await apiCall('/predictions/summary');
    updatePredictions(summary);
    showNotification('Simulation complete!', 'success');
  } catch (error) {
    console.error('Simulation error:', error);
  }
}

function updatePredictions(data) {
  if (data.avg_survival_1year) {
    document.getElementById('pred-survival').textContent = data.avg_survival_1year.toFixed(1) + '%';
  }
  
  // Update chart
  if (predChart) predChart.destroy();
  
  const ctx = document.getElementById('predictionChart').getContext('2d');
  predChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Current', '1 Year', '3 Years', '5 Years'],
      datasets: [{
        label: 'Survival Rate',
        data: [100, data.avg_survival_1year || 90, data.avg_survival_3year || 85, data.avg_survival_5year || 80],
        borderColor: '#2a5a49',
        backgroundColor: 'rgba(42, 90, 73, 0.1)',
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: { beginAtZero: false, min: 70, max: 100 }
      }
    }
  });
}

document.addEventListener('DOMContentLoaded', runSimulation);
</script>
<script>
  // Check authentication after auth.js loads
  if (!auth.isAuthenticated()) {
      window.location.href = '/login.html';
  }
</script>
</body></html>
