<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Nursery Management - MsituMum</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        "primary": "#13ec13",
        "green-dark": "#1a3a1a",
        "green-medium": "#4c854c",
      },
      fontFamily: {
        "display": ["Inter", "sans-serif"]
      }
    }
  }
}
</script>
</head>
<body class="font-display bg-gray-50">
<!-- Include same sidebar as index.html -->
<div class="relative flex min-h-screen w-full">
<aside class="sticky top-0 h-screen w-64 flex-shrink-0 bg-green-800 p-4 flex flex-col justify-between">
<div class="flex flex-col gap-6">
<div class="flex items-center gap-3">
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10" style='background-image: url("https://cdn-icons-png.flaticon.com/512/628/628283.png");'></div>
<div class="flex flex-col">
<h1 class="text-white text-base font-medium">MsituMum</h1>
<p class="text-green-200 text-sm">Restoration System</p>
</div>
</div>
<nav class="flex flex-col gap-2">
<a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10 text-white" href="index.html">
<span class="material-symbols-outlined">dashboard</span>
<p class="text-sm font-medium">Dashboard</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10 text-white" href="sites.html">
<span class="material-symbols-outlined">map</span>
<p class="text-sm font-medium">Sites</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-lg bg-green-700 text-white" href="nursery.html">
<span class="material-symbols-outlined">local_florist</span>
<p class="text-sm font-bold">Nurseries</p>
</a>
<a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10 text-white" href="prediction.html">
<span class="material-symbols-outlined">insights</span>
<p class="text-sm font-medium">Predictions</p>
</a>
</nav>
</div>
</aside>

<main class="flex-1 p-8">
<header class="flex justify-between items-center mb-6">
<div>
<h1 class="text-3xl font-black text-gray-900">Nursery Management</h1>
<p class="text-gray-600">Visualize and manage your nursery beds and seedlings.</p>
</div>
<a href="/forms/nursery-form.html" class="flex items-center gap-2 bg-green-700 text-white px-4 py-2 rounded-lg hover:bg-green-800">
<span class="material-symbols-outlined">add</span>
<span>Add New Nursery</span>
</a>
</header>

<div class="bg-white rounded-xl border border-gray-200">
<div class="flex items-center justify-between p-4 border-b">
<div class="flex gap-2">
<button class="p-2 text-gray-700 rounded-lg hover:bg-gray-100">
<span class="material-symbols-outlined">search</span>
</button>
<button class="p-2 text-gray-700 rounded-lg hover:bg-gray-100">
<span class="material-symbols-outlined">filter_list</span>
</button>
</div>
<button class="flex items-center gap-2 bg-primary text-gray-900 px-4 py-2 rounded-lg hover:opacity-90" onclick="generateNurseryReport()">
<span class="material-symbols-outlined">description</span>
<span class="text-sm font-bold">Generate Report</span>
</button>
</div>

<div class="flex gap-3 p-4 border-b overflow-x-auto">
<button class="px-4 py-2 rounded-full bg-green-100 text-green-800 text-sm font-medium" onclick="filterStage('all')">All Beds</button>
<button class="px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm hover:bg-green-100" onclick="filterStage('sowing')">Sowing</button>
<button class="px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm hover:bg-green-100" onclick="filterStage('germination')">Germination</button>
<button class="px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm hover:bg-green-100" onclick="filterStage('hardening')">Hardening</button>
<button class="px-4 py-2 rounded-full bg-gray-100 text-gray-700 text-sm hover:bg-green-100" onclick="filterStage('ready')">Ready for Transplant</button>
</div>

<div id="nursery-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-6">
<!-- Populated by JavaScript -->
</div>
</div>
</main>
</div>

<script src="/js/auth.js"></script>
<script>
async function loadNurseries() {
  try {
    const nurseries = await apiCall('/nurseries');
    displayNurseries(nurseries);
  } catch (error) {
    console.error('Error loading nurseries:', error);
  }
}

function displayNurseries(nurseries) {
  const grid = document.getElementById('nursery-grid');
  
  if (nurseries.length === 0) {
    grid.innerHTML = '<div class="col-span-full text-center py-12 text-gray-500">No nurseries found. Add your first nursery!</div>';
    return;
  }
  
  grid.innerHTML = nurseries.map(nursery => `
    <div class="flex flex-col gap-3 rounded-lg border border-gray-200 p-3 hover:shadow-lg transition-all cursor-pointer" onclick="viewNursery(${nursery.id})">
      <div class="w-full bg-green-200 aspect-[4/3] rounded-lg flex items-center justify-center">
        <span class="material-symbols-outlined text-6xl text-green-700">local_florist</span>
      </div>
      <div class="flex flex-col gap-1">
        <p class="text-gray-900 text-base font-bold">${nursery.nursery_name}</p>
        <p class="text-gray-600 text-sm">Total: ${nursery.total_seedlings || 0} seedlings</p>
        <p class="text-gray-600 text-sm">Capacity: ${nursery.total_capacity || 'N/A'}</p>
        <div class="flex items-center gap-2 mt-1">
          <span class="inline-flex items-center rounded-md bg-green-100 px-2 py-1 text-xs font-medium text-green-700">
            ${nursery.species_count || 0} species
          </span>
        </div>
      </div>
    </div>
  `).join('');
}

function viewNursery(id) {
  window.location.href = `nursery-detail.html?id=${id}`;
}

function showAddNurseryForm() {
  alert('Add nursery form will open here');
}

function generateNurseryReport() {
  alert('Nursery report generation');
}

function filterStage(stage) {
  alert('Filter by stage: ' + stage);
}

document.addEventListener('DOMContentLoaded', loadNurseries);
</script>
<script>
  // Check authentication after auth.js loads
  if (!auth.isAuthenticated()) {
      window.location.href = '/login.html';
  }
</script>
</body></html>
